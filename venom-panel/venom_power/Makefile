# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”§ Venom Power Daemon - Makefile
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Ø§Ù„Ù…ØªØ±Ø¬Ù… ÙˆØ§Ù„Ø£Ø¹Ù„Ø§Ù…
CC = gcc
CFLAGS = -Wall -Wextra -O2 -I./include
LDFLAGS = $(shell pkg-config --cflags --libs gio-2.0 x11 xscrnsaver)

# Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
SRC_DIR = src
INC_DIR = include
BUILD_DIR = build

# Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØµØ¯Ø±ÙŠØ©
SOURCES = $(wildcard $(SRC_DIR)/*.c)
OBJECTS = $(patsubst $(SRC_DIR)/%.c,$(BUILD_DIR)/%.o,$(SOURCES))

# Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
TARGET = venom_power

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: all clean install uninstall run debug

# Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
all: $(BUILD_DIR) $(TARGET)

# Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡
$(BUILD_DIR):
	@mkdir -p $(BUILD_DIR)

# Ø±Ø¨Ø· Ø§Ù„Ù…Ù„ÙØ§Øª
$(TARGET): $(OBJECTS)
	@echo "ğŸ”— Linking $(TARGET)..."
	@$(CC) $(OBJECTS) -o $@ $(LDFLAGS)
	@echo "âœ… Build complete: $(TARGET)"

# ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØµØ¯Ø±ÙŠØ©
$(BUILD_DIR)/%.o: $(SRC_DIR)/%.c
	@echo "ğŸ“¦ Compiling $<..."
	@$(CC) $(CFLAGS) -c $< -o $@ $(LDFLAGS)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§¹ Ø§Ù„ØªÙ†Ø¸ÙŠÙ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

clean:
	@echo "ğŸ§¹ Cleaning..."
	@rm -rf $(BUILD_DIR) $(TARGET)
	@echo "âœ… Clean complete"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“¦ Ø§Ù„ØªØ«Ø¨ÙŠØª
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

install: $(TARGET)
	@echo "ğŸ“¦ Installing $(TARGET)..."
	@sudo cp $(TARGET) /usr/local/bin/
	@sudo cp org.venom.Power.service /usr/share/dbus-1/services/ 2>/dev/null || true
	@echo "âœ… Installed to /usr/local/bin/$(TARGET)"

uninstall:
	@echo "ğŸ—‘ï¸ Uninstalling $(TARGET)..."
	@sudo rm -f /usr/local/bin/$(TARGET)
	@sudo rm -f /usr/share/dbus-1/services/org.venom.Power.service
	@echo "âœ… Uninstalled"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ Ø§Ù„ØªØ´ØºÙŠÙ„
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

run: $(TARGET)
	@echo "ğŸš€ Running $(TARGET)..."
	@./$(TARGET)

# Ø¨Ù†Ø§Ø¡ Ù…Ø¹ Ø±Ù…ÙˆØ² Ø§Ù„ØªØµØ­ÙŠØ­
debug: CFLAGS += -g -DDEBUG
debug: clean all
	@echo "ğŸ› Debug build complete"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§ª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

test-battery:
	@echo "ğŸ”‹ Testing GetBatteryInfo..."
	@dbus-send --session --print-reply --dest=org.venom.Power \
		/org/venom/Power org.venom.Power.GetBatteryInfo

test-brightness:
	@echo "ğŸ’¡ Testing GetBrightness..."
	@dbus-send --session --print-reply --dest=org.venom.Power \
		/org/venom/Power org.venom.Power.GetBrightness

test-lid:
	@echo "ğŸ’» Testing GetLidState..."
	@dbus-send --session --print-reply --dest=org.venom.Power \
		/org/venom/Power org.venom.Power.GetLidState

test-inhibit:
	@echo "ğŸš« Testing Inhibit..."
	@dbus-send --session --print-reply --dest=org.venom.Power \
		/org/venom/Power org.venom.Power.Inhibit \
		string:"idle" string:"Test" string:"Testing inhibitor"

test-all: test-battery test-brightness test-lid test-profile
	@echo "âœ… All tests completed"

test-profile:
	@echo "âš¡ Testing Power Profiles..."
	@dbus-send --session --print-reply --dest=org.venom.Power \
		/org/venom/Power org.venom.Power.GetActiveProfile
	@dbus-send --session --print-reply --dest=org.venom.Power \
		/org/venom/Power org.venom.Power.GetProfiles
